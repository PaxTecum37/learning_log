# The configuration of the app when its exposed to the web.
applications:
  ll_project:
    web:
      commands:
        start: "gunicorn -w 4 -b unix:$SOCKET ll_project.wsgi:application"
      upstream:
        socket_family: unix
      locations:
        "/":
          passthru: true
        "/static":
          root: "static"
          expires: 1h
          allow: true

    #Set a local read/write mount for logs.
    mounts:
      "logs":
        source: local
        source_path: logs

    # The hooks executed at various points in the lifecycle of the application.
    hooks:
      build: |
        pip install --upgrade pip
        pip install -r requirements.txt
        pip install -r requirements_remote.txt

        mkdir logs
        python manage.py collectstatic
        rm -rf logs
      deploy: |
        python manage.py migrate